(function(c,b){c.soco=c.soco||{};
c.soco.commons=c.soco.commons||{};
c.soco.TEMPLATE_PARAMNAME=":templatename";
c.soco.filterHTMLFragment=c.soco.filterHTMLFragment||function(d,f){try{f.call(null,b(d))
}catch(g){throw g
}};
var a={};
a.CLEAR="lcl.cq.soco.events.clear";
c.soco.commons.handleOnBlur=function(d,e){if((b(d).val()==="")||(b(d).val()==="<br/>")){b(d).val(e)
}};
c.soco.commons.handleOnFocus=function(d,e){if(b(d).val()===e){b(d).val("")
}};
c.soco.commons.getMessage=function(d){var f=b(d).first().val();
if(typeof CKEDITOR!=="undefined"){var e=CKEDITOR.instances[b(d).attr("id")];
if(e){f=e.getData()
}}return f
};
c.soco.commons.validateFieldNotEmptyOrDefaultMessage=function(f,e){c.soco.commons.syncRTE(f);
var d=b(f).val();
if(!e){e=""
}var g="tempRTEValidate_"+Math.floor(Math.random()*1001);
b(f).after("<div id='"+g+"' height='0px' style='visibility:hidden;' width='0px'></div>");
d=c.soco.commons.stripNonText(d);
e=c.soco.commons.stripNonText(e);
b("#"+g).append(d);
b("#"+g+" div:empty").filter(function(){return b(this)
}).remove();
b("#"+g+" p:empty").filter(function(){return b(this)
}).remove();
d=b("#"+g).html();
b("#"+g).remove();
if(b.trim(d).length===0||b.trim(d)===e){alert(c.I18n.getMessage("Comment field cannot be empty or default message."));
return false
}else{return true
}};
c.soco.commons.stripNonText=function(d){d=d.replace(/\s|&nbsp;/g,"");
d=d.replace(/\r?\n|\r/g,"");
d=d.replace(/(<|&lt;)br\s*\/*(>|&gt;)/g,"");
return d
};
c.soco.commons.syncRTE=function(d){if(typeof CKEDITOR!=="undefined"){var e=CKEDITOR.instances[b(d).attr("name")];
if(!e){e=CKEDITOR.instances[b(d).attr("id")]
}if(e&&e.checkDirty()){e.updateElement();
e.resetDirty()
}}};
c.soco.commons.clientSideComposer=function(i,k,j,e,h,g,f){var l=g||i.attr("action"),d=f||i.attr("method")||"POST";
i.find(":submit").click(function(s){var o=$.map(i.find(":input[type='file']"),function(v){var u=$(v);
if(u.val()===""||u.val()===undefined){return null
}return true
}).length>0;
if(o){return
}s.preventDefault();
var r=b(s.target).closest("form")[0],t;
if(b.isFunction(r.onsubmit)){if(!r.onsubmit.call(r,s)){return
}}var q=i.find("textarea");
c.soco.commons.syncRTE(q);
t=b(r).serialize();
if(k){t+="&"+encodeURIComponent(c.soco.TEMPLATE_PARAMNAME)+"="+encodeURIComponent(k)
}for(var p in h){t+="&"+encodeURIComponent(p)+"="+encodeURIComponent(h[p])
}b(r).find(":input:visible").each(function(){b(this).attr("disabled","disabled")
});
var n=function(v,u,w){if((w.status===201)||(w.status===200)){b(r).find(":input:visible").each(function(){switch(this.type){case"password":case"select-multiple":case"select-one":case"text":case"textarea":b(this).val("");
break;
case"checkbox":case"radio":this.checked=false
}b(this).removeAttr("disabled")
});
b(r).find(":input:hidden").each(function(){b(this).trigger(a.CLEAR)
});
j.call(null,v,u,w)
}else{b(r).find(":input:visible").each(function(){b(this).removeAttr("disabled")
});
e.call(null,w,u)
}};
var m=function(v,u){b(r).find(":input:visible").each(function(){b(this).removeAttr("disabled")
});
e.call(null,v,u)
};
b.ajax(l,{data:t,success:n,fail:m,type:d})
})
};
c.soco.commons.fillInputFromClientContext=function(d,e){if(window.CQ_Analytics&&CQ_Analytics.CCM){b(function(){var f=CQ_Analytics.CCM.getRegisteredStore(CQ_Analytics.ProfileDataMgr.STORENAME);
if(f){var g=f.getProperty(e,true)||"";
d.val(g)
}CQ_Analytics.CCM.addListener("storesloaded",function(){var h=CQ_Analytics.CCM.getRegisteredStore(CQ_Analytics.ProfileDataMgr.STORENAME);
if(h&&h.addListener){var i=h.getProperty(e,true)||"";
d.val(i);
h.addListener("update",function(){var j=h.getProperty(e,true)||"";
d.val(j)
})
}})
})
}};
c.soco.commons.activateRTE=function(f,d){var e=f.find("textarea");
c.soco.commons.convertTextAreaToRTE(e,d,true)
};
c.soco.commons.convertTextAreaToRTE=function(d,g,j){var e=d.width(),q=d.height(),p=[{name:"basicstyles",items:["Bold","Italic","Underline"]}],n={},m=d[0],o,k;
var h=g||["onfocus","onblur"];
if(m!==null&&typeof m!=="undefined"){for(k=0;
k<h.length;
k++){o=h[k];
if(null!==m[o]){n[o.substring(2)]=m[o]
}}}o=null;
b(d).height(d.height()+60);
var f={width:e,height:q,toolbar:p};
if(!j){f.width=d.width()===0?"100%":e;
f.height=d.height()===0?"100%":q;
f.toolbarLocation="bottom";
f.resize_enabled=false;
f.removePlugins="elementspath"
}else{f.width=e+4;
f.height=q+60
}var l=CKEDITOR.replace(b(d).attr("name"),f);
l.on("key",function(i){c.soco.commons.syncRTE(d)
});
d.on(a.CLEAR,function(i){b(m).val("");
l.setData("",function(){b(l).blur();
l.resetDirty()
})
});
return l
};
c.soco.commons.openModeration=function(){var d="";
if(c.WCM!==undefined&&c.WCM.getPagePath!==undefined){d=c.WCM.getPagePath()
}else{if(Granite.author!==undefined&&Granite.author.page!==undefined&&Granite.author.page.path!==undefined){d=Granite.author.page.path
}}c.shared.Util.open(c.shared.HTTP.externalize("/communities/moderation.html"))
};
c.soco.commons.showUGCFormAsDialog=function(h,f){var g=b(f);
var d=g.attr("id");
var e="modalIframeParent"+Math.random().toString(36).substring(2,4);
if(!d){g.attr("id",e);
d=e
}g.dialog({modal:true,height:500,width:750,buttons:{Submit:function(){var i=b("iframe.modalIframeClass",g).contents().find("form");
i.submit();
b(this).dialog("close")
},Cancel:function(){b(this).dialog("close")
}}});
g.html("<iframe class='modalIframeClass' width='100%' height='100%' marginWidth='0' marginHeight='0' frameBorder='0' />").dialog("open");
b("#"+d+" .modalIframeClass").attr("src",h);
return false
}
})(CQ,$CQ);
var CQ_collab_comments_loadedForms={};
var CQ_collab_comments_defaultMessage="";
var CQ_collab_comments_requireLogin=false;
var CQ_collab_comments_enterComment="Please enter a comment";
function CQ_collab_comments_toggleForm(c,h,a){var d=document.getElementById(h);
var b=document.getElementById(c);
try{a=CQ.shared.HTTP.noCaching(a);
CQ.shared.HTTP.get(a,function(p,k,j){var e=j.responseText;
$CQ(d).html(e);
var n=$CQ(d).children("form").attr("id");
if(n){var m=n.split("-");
m.length=m.length-1;
var l=m.join("-");
if(CQ_Analytics&&CQ_Analytics.CCM){var i=CQ_Analytics.CCM.getRegisteredStore(CQ_Analytics.ProfileDataMgr.STORENAME);
if(i){CQ_collab_comments_formStateChanged(l,i)
}}}})
}catch(g){alert("Error loading form: "+a)
}var f=d.style.display!="block";
d.style.display=f?"block":"none";
b.innerHTML=f?"Cancel":"Reply"
}function CQ_collab_comments_handleOnFocus(a,b){if(a.value==CQ_collab_comments_getDefaultMessage(b)){a.value=""
}a.style.color="#333"
}function CQ_collab_comments_handleOnBlur(a,b){if(a.value===""){a.value=CQ_collab_comments_getDefaultMessage(b);
a.style.color="#888"
}else{a.style.color="#333"
}}function CQ_collab_comments_validateFields(b){var a=document.getElementById(b+"-text");
if(a.value===""||a.value===CQ_collab_comments_getDefaultMessage(b)){CQ_collab_comments_showError(CQ_collab_comments_enterComment,b);
return false
}return true
}function CQ_collab_comments_validateSubmit(d){if(!CQ_collab_comments_validateFields(d)){return false
}try{var a=document.getElementById(d+"-id");
if(!a){var b=document.getElementById(d+"-form");
a=document.createElement("input");
a.id=d+"-id";
a.type="hidden";
a.name="id";
a.value="nobot";
b.appendChild(a)
}}catch(c){return false
}return true
}function CQ_collab_comments_showError(b,c){var a=document.getElementById(c+"-error");
if(!a){alert(b)
}else{a.innerHTML=b
}}function CQ_collab_comments_getDefaultMessage(a){if(a&&document.getElementById(a+"-rating")){return CQ_collab_ratings_defaultMessage
}return CQ_collab_comments_defaultMessage
}function CQ_collab_comments_openCollabAdmin(){CQ.shared.Util.open(CQ.shared.HTTP.externalize("/socoadmin.html#/content/usergenerated"+CQ.WCM.getPagePath()))
}function CQ_collab_comments_activate(a,b){if(!a){a="Activate"
}CQ.HTTP.post("/bin/replicate.json",function(d,e,c){if(a==="Delete"){CQ.Notification.notify(null,e?CQ.I18n.getMessage("Comment deleted"):CQ.I18n.getMessage("Unable to delete comment"))
}else{CQ.Notification.notify(null,e?CQ.I18n.getMessage("Comment activated"):CQ.I18n.getMessage("Unable to activate comment"))
}if(b){b.call(this,d,e,c)
}},{_charset_:"utf-8",path:this.path,cmd:a})
}function CQ_collab_comments_refresh(){if(this.refreshCommentSystem){this.refreshCommentSystem()
}else{CQ.wcm.EditBase.refreshPage()
}}function CQ_collab_comments_afterEdit(a){CQ_collab_comments_activate.call(a,"Activate",CQ_collab_comments_refresh)
}function CQ_collab_comments_afterDelete(a){CQ_collab_comments_activate.call(a,"Delete",CQ_collab_comments_refresh)
}function CQ_collab_comments_initFormState(a){if(CQ_Analytics&&CQ_Analytics.CCM){$CQ(function(){CQ_Analytics.ClientContextUtils.onStoreRegistered(CQ_Analytics.ProfileDataMgr.STORENAME,function(b){CQ_collab_comments_formStateChanged(a,b);
b.addListener("update",function(){CQ_collab_comments_formStateChanged(a,b)
})
})
})
}}function CQ_collab_comments_formStateChanged(a,g){var c=g.getData();
if(c){var h=a+"-form";
var j=a+"-text";
var b=a+"-userIdentifier";
var e=a+"-email";
var i=a+"-url";
var f=c.authorizableId;
var d=c.formattedName;
if(!d){d=f
}if(f&&f=="anonymous"){if(CQ_collab_comments_requireLogin){$CQ("#"+h).hide();
$CQ("[id$=-reply-button]").hide();
$CQ("[id$=-reply-arrow]").hide()
}else{$CQ("#"+h).show();
$CQ("[id$=-reply-button]").show();
$CQ("[id$=-reply-arrow]").show();
$CQ("#"+b).attr("value","");
$CQ("#"+b+"-comment-block").show();
$CQ("#"+e).attr("value","");
$CQ("#"+e+"-comment-block").show();
$CQ("#"+i).attr("value","");
$CQ("#"+i+"-comment-block").show();
$CQ("[id$=-signed-in-text]").hide();
$CQ("[id$=-signed-in-user]").text("")
}}else{$CQ("[id$=-reply-button]").show();
$CQ("[id$=-reply-arrow]").show();
$CQ("#"+b+"-comment-block").hide();
$CQ("#"+b).attr("value",f);
$CQ("#"+e+"-comment-block").hide();
$CQ("#"+i+"-comment-block").hide();
$CQ("[id$=-signed-in-user]").text(d);
$CQ("[id$=-signed-in-text]").show()
}}}(function(d){window.CQ_Analytics=window.CQ_Analytics||{};
var b=window.CQ_Analytics;
var c=d.Model.extend({modelName:"SubscriptionModel",events:{UPDATED:"subscribe:update",UPDATE_ERROR:"subscribe:updateError"},doToggle:function(g){var i=_.bind(function(l){var m=l.response;
if(typeof(m)!="object"){m=JSON.parse(m)
}this.set("states",m.states);
this.set("subscribed",m.subscribed);
this.trigger(this.events.UPDATED,{model:this});
var k=this.get("states");
var n=this.get("subscribed");
if(g==="following"&&n&&k.following.selected){if(!_.isUndefined(window._satellite)){window._satellite.track("communities-scf-follow")
}else{if(b.Sitecatalyst){b.record({event:"SCFFollow",values:{functionType:d.Context.communityFunction,path:d.Context.path,type:d.Context.type,ugcTitle:d.Context.ugcTitle,siteTitle:d.Context.siteTitle,sitePath:d.Context.sitePath,groupTitle:d.Context.groupTitle,groupPath:d.Context.groupPath,user:d.Context.user},collect:false,componentPath:d.constants.ANALYTICS_BASE_RESOURCE_TYPE})
}}}},this);
var f=_.bind(function(m,l,k){d.log.error("error toggle follow state %o",k)
},this);
var e=this.get("url");
var j=[];
var h=[];
$CQ.each(this.get("states"),function(k,m){var l=m.selected;
if(g=="unfollow-all"){l=false
}else{if(k==g){l=!l
}}j.push(k);
h.push(l.toString())
});
$CQ.ajax(e,{dataType:"json",type:"POST",xhrFields:{withCredentials:true},data:{":operation":"social:updatesubscriptions",types:j,states:h,subscribedId:this.get("subscribedId")},success:i,error:f})
}});
var a=d.View.extend({viewName:"SubscriptionView",init:function(){this.listenTo(this.model,this.model.events.UPDATED,this.update);
this.listenTo(this.model,this.model.events.UPDATE_ERROR,this.showError)
},handleClick:function(g){var e=g.currentTarget;
var f=e.getAttribute("data_type");
this.model.doToggle(f);
$("#followDropdownMenu").attr("aria-expanded","false")
},toggle:function(f){if($("#followDropdownMenu").attr("aria-expanded")=="false"){$("#followDropdownMenu").attr("aria-expanded","true")
}else{$("#followDropdownMenu").attr("aria-expanded","false")
}},update:function(){this.render()
}});
d.Subscription=c;
d.SubscriptionView=a;
d.registerComponent("social/subscriptions/components/hbs/subscriptions",d.Subscription,d.SubscriptionView)
})(SCF);